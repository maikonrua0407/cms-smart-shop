@using SmartShop.UI
@using System.Data
@using SmartShop.DAL

@{
    decimal giaBan = 0;
    decimal dChietKhau = 0;
    string chietkhau = "";
    var cat = ProductCatSvr.GetAllCategory();
    int totalRecord = 0;
}
@foreach (var iCat in cat)
{
    var lstGroup = ProductGroupSvr.GetByCategoryHasProduct(iCat.CategoryID);
    if (lstGroup.Count() > 0)
    {
        <div class="cate-item">
            <h2 class="title"><a href="#">@iCat.CategoryName</a></h2>
            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <div class="cattab header-navigation">
                        <ul>
                            @foreach (var item in lstGroup)
                            {
                                string idNhom = item.ProductGroupID.ToString();
                                DataSet ds = ProductSvr.GetSanPhamTheoDieuKien(idNhom, "ID", "GIAM", 10, 1, ref totalRecord);

                                var showgroup = iCat.CategoryID + "dvNhom" + item.ProductGroupID.ToString();

                                <li class='dropdown'><a href="#" style="padding: 5px 18px;font-size: 14px;text-transform: capitalize;">@item.GroupName</a></li>
                            }
                        </ul>
                    </div>
                </div>
            </div>
            @foreach (var item in lstGroup)
            {
                string idNhom = item.ProductGroupID.ToString();
                var classGroup = "GroupHome" + iCat.CategoryID.ToString();
                DataSet ds = ProductSvr.GetSanPhamTheoDieuKien(idNhom, "ID", "GIAM", 10, 1, ref totalRecord);
                if (ds != null && ds.Tables.Count > 0 && ds.Tables[0].Rows.Count > 0)
                {
                    DataTable dt = ds.Tables[0];
                    var showgroup = iCat.CategoryID + "dvNhom" + item.ProductGroupID.ToString();
                    if (lstGroup.ToList().IndexOf(item) == 0)
                    {
                        <div id='@showgroup' class='owl-carousel owl-carousel5'>

                            @foreach (DataRow r in dt.Rows)
                            {
                                <div>
                                    @{
                                        giaBan = decimal.Parse(r["YTE_GIA_BAN"].ToString());
                                        dChietKhau = 0;
                                        string path = HeThong.duongdan_anhSP(Convert.ToInt32(r["ID"]), r["YTE_ANH_CHINH"].ToString());
                                        var href = AppEnv.ApplicationPath + "/" + iCat.NoSymbolName + "/" + item.NoSymbolName + "/" + Util.converToUnsign(r["TEN"].ToString()) + ".html";
                                    }
                                    <div class="product-item">
                                        @if (r["YTE_CHIET_KHAU"] != null && !r["YTE_CHIET_KHAU"].ToString().Equals("") && decimal.Parse(r["YTE_CHIET_KHAU"].ToString()) > 0)
                                        {
                                            dChietKhau = decimal.Parse(r["YTE_CHIET_KHAU"].ToString());
                                            chietkhau = String.Format("{0:0,0;(0:0,0);Liên hệ}", (dChietKhau / giaBan) * 100);
                                            <div class="starPromotion">
                                                <span>- @chietkhau %</span>
                                            </div>
                                        }
                                        <div class="pi-img-wrapper">
                                            <a href="@href">
                                                <img src="@path" class="img-responsive" title="@r["TEN"].ToString()" alt="@r["TEN"].ToString()">
                                            </a>
                                        </div>
                                        <h3>
                                            <a href="@href" title="@r["TEN"].ToString()">@r["TEN"].ToString()</a>
                                        </h3>
                                        <!---Gift content-->
                                        <div class="gift-img">&nbsp;</div>
                                        @if (dChietKhau > 0)
                                        {
                                        <!--##GIÁ ĐẶC BIỆT##-->
                                            <div class="pi-price">
                                                <p class="special-price">
                                                    <span class="price-label">Giá KM:</span> <span class="price">@String.Format("{0:0,0;(0:0,0);Liên hệ}", giaBan - dChietKhau)</span>
                                                </p>
                                                <p class="save-cost">
                                                    <span>Giảm: @String.Format("{0:0,0;(0:0,0);Liên hệ}", dChietKhau)</span>
                                                </p>
                                                <p class="old-price">
                                                    <span class="price-label"></span><span class="price">Giá NY: @String.Format("{0:0,0;(0:0,0);Liên hệ}", giaBan)</span>
                                                </p>
                                            </div>
                                        <!--Nếu giá đặc biệt quá hạn-->
                                        <!--##GIÁ ĐẶC BIỆT##-->
                                        }
                                        else
                                        {
                                            <div class="pi-price">@String.Format("{0:0,0;(0:0,0);Liên hệ}", giaBan)</div>
                                        }
                                    </div>
                                </div>
                                        }
                        </div>
                                        }
                                        @*else
                                            {
                                                               <div id='@showgroup' class='owl-carousel owl-carousel5'>
                                                                   @foreach (DataRow r in dt.Rows)
                                                                       {
                                                                       <div>

                                                                           @{
                                                                                   giaBan = decimal.Parse(r["YTE_GIA_BAN"].ToString());
                                                                                   dChietKhau = 0;
                                                                                   string path = HeThong.duongdan_anhSP(Convert.ToInt32(r["ID"]), r["YTE_ANH_CHINH"].ToString());
                                                                                   var href = AppEnv.ApplicationPath + "/" + iCat.NoSymbolName + "/" + item.NoSymbolName + "/" + Util.converToUnsign(r["TEN"].ToString()) + ".html";
                                                                           }

                                                                           <div class="product-item">
                                                                               @if (r["YTE_CHIET_KHAU"] != null && !r["YTE_CHIET_KHAU"].ToString().Equals("") && decimal.Parse(r["YTE_CHIET_KHAU"].ToString()) > 0)
                                                                                   {
                                                                                       dChietKhau = decimal.Parse(r["YTE_CHIET_KHAU"].ToString());
                                                                                       chietkhau = String.Format("{0:0,0;(0:0,0);Liên hệ}", (dChietKhau / giaBan) * 100);
                                                                                   <div class="starPromotion">
                                                                                       <span>- @chietkhau %</span>
                                                                                   </div>
                                                                                   }
                                                                               <div class="pi-img-wrapper">
                                                                                   <a href="@href">
                                                                                       <img src="@path" class="img-responsive" title="@r["TEN"].ToString()" alt="@r["TEN"].ToString()">
                                                                                   </a>
                                                                               </div>
                                                                               <h3>
                                                                                   <a href="@href" title="@r["TEN"].ToString()">@r["TEN"].ToString()</a>
                                                                               </h3>
                                                                               <!---Gift content-->
                                                                               <div class="gift-img">&nbsp;</div>
                                                                               @if (dChietKhau > 0)
                                                                                   {
                                                                                                   <!--##GIÁ ĐẶC BIỆT##-->
                                                                                   <div class="pi-price">
                                                                                       <p class="special-price">
                                                                                           <span class="price">@String.Format("{0:0,0;(0:0,0);Liên hệ}", giaBan - dChietKhau)</span>
                                                                                       </p>
                                                                                       <p class="save-cost">
                                                                                           <span>Giảm: @String.Format("{0:0,0;(0:0,0);Liên hệ}", dChietKhau)</span>
                                                                                       </p>
                                                                                       <p class="old-price">
                                                                                           <span class="price-label"></span><span class="price">Giá NY: @String.Format("{0:0,0;(0:0,0);Liên hệ}", giaBan)</span>
                                                                                       </p>
                                                                                   </div>
                                                                                                   <!--Nếu giá đặc biệt quá hạn-->
                                                                                                   <!--##GIÁ ĐẶC BIỆT##-->
                                                                                   }
                                                                                   else
                                                                                   {
                                                                                   <div class="pi-price">@String.Format("{0:0,0;(0:0,0);Liên hệ}", giaBan)</div>
                                                                                   }
                                                                           </div>
                                                                       </div>
                                                                                   }
                                                               </div>
                                                                                               }*@
                                            }
                                        }
        </div>
                                            }
                                        }
